// import 'dart:ffi';import 'package:easy_localization/easy_localization.dart';import 'package:flutter/material.dart';import 'package:flutter_bloc/flutter_bloc.dart';import 'package:yandex_mapkit/yandex_mapkit.dart';import 'dart:ui';import '../../../app/app.dart';import '../../../app/router.dart';import '../../../common/repository/network_result.dart';import '../../../common/widgets/marquee_widget.dart';import '../block/add_new_bloc.dart';import '../repository/add_new_repository.dart';class AddNewPageWithRepo extends StatelessWidget {  const AddNewPageWithRepo({super.key});  @override  Widget build(BuildContext context) {    return BlocProvider(      create: (context) => AddNewBloc(context.read<AddNewRepository>()),      child: const AddNewScreen(),    );  }}class AddNewScreen extends StatefulWidget {  const AddNewScreen({super.key});  @override  State<AddNewScreen> createState() => _AddNewScreenState();}class _AddNewScreenState extends State<AddNewScreen> {  final TextEditingController _titleController = TextEditingController();  final TextEditingController _descController = TextEditingController();  final TextEditingController _addressController = TextEditingController();  late AddNewBloc _addNewBloc;  final _formKey = GlobalKey<FormState>();  double latitude = 0.0;  double longitude = 0.0;  @override  void initState() {    _addNewBloc = BlocProvider.of<AddNewBloc>(context);    super.initState();  }  late YandexMapController yandexMapController;  @override  Widget build(BuildContext context) {    return SafeArea(      child: Scaffold(          appBar: PreferredSize(              preferredSize: Size.fromHeight(kToolbarHeight),              // child: CustomAppBar(titleName: "add_new_place".tr()),              child: Card(                elevation: 2.0, // cardElevation                shape: RoundedRectangleBorder(                  borderRadius: BorderRadius.circular(0.0),                ),                child: Container(                  height: kToolbarHeight,                  child: Row(                    children: [                      InkWell(                        onTap: () {                          finish(context);                        },                        child: Center(                          child: Container(                            padding: EdgeInsets.fromLTRB(16.0, 10.0, 10.0, 16.0),                            child: Icon(Icons.close),                          ),                        ),                      ),                      Expanded(                        child: SingleChildScrollView(                          padding: EdgeInsets.only(right: 16.0),                          scrollDirection: Axis.horizontal,                          child: MarqueeWidget(                              direction: Axis.horizontal,                              child: Text(                                "add_new_place".tr(),                                style: TextStyle(                                  fontFamily: 'Montserrat',                                  color: Colors.black,                                  fontSize: 16.0,                                  fontWeight: FontWeight.w600,                                ),                              )),                        ),                      ),                      InkWell(                        onTap: () {                          if (_formKey.currentState!.validate()) {                            _addNewBloc.add(AddNewEventData(title: _titleController.text, description: _descController.text, lat: latitude, lot: longitude));                          }                        },                        child: Container(                          padding: EdgeInsets.all(10.0),                          child: Transform.rotate(angle: 3.14159265359, child: Image.asset("assets/images/back_btn.png")),                        ),                      )                      // Add other widgets as needed                    ],                  ),                ),              )),          backgroundColor: Colors.white,          body: BlocConsumer<AddNewBloc, NetworkResult>(listener: (context, state) {            if (state is Error) {              hideLoading();              snack(context, state.message.toString());            } else if (state is Success) {              hideLoading();              router.dispose();              router.go(Routes.choose_language);            } else if (state is Loading) {              showLoading(context);            } else {              hideLoading();              snack(context, state.message.toString());            }          }, builder: (context, state) {            return SingleChildScrollView(              child: Padding(                padding: const EdgeInsets.all(10.0),                child: Form(                  key: _formKey,                  child: Column(                    crossAxisAlignment: CrossAxisAlignment.stretch,                    children: [                      Text(                        "title".tr(),                        textAlign: TextAlign.left,                        style: TextStyle(color: Colors.black, fontSize: 16, fontFamily: 'Mulish', fontWeight: FontWeight.w400),                      ),                      SizedBox(                        height: 6,                      ),                      TextFormField(                          controller: _titleController,                          decoration: customTextFieldDecoration("enter_title".tr()),                          validator: (value) => validateNonEmpty(value ?? "", "enter_title".tr())),                      SizedBox(                        height: 10,                      ),                      Text(                        "description".tr(),                        textAlign: TextAlign.left,                        style: TextStyle(color: Colors.black, fontSize: 18, fontFamily: 'Mulish', fontWeight: FontWeight.w400),                      ),                      SizedBox(                        height: 6,                      ),                      TextFormField(                        textAlignVertical: TextAlignVertical.bottom,                        maxLines: 7,                        controller: _descController,                        decoration: customTextFieldDecoration("enter_description".tr()),                        validator: (value) => validateNonEmpty(value ?? "", "enter_description".tr()),                      ),                      SizedBox(                        height: 30,                      ),                      Row(                        children: [                          Expanded(                            child: Container(                              height: 1,                              color: Colors.black,                            ),                          ),                          Padding(                            padding: const EdgeInsets.symmetric(horizontal: 15.0),                            child: Text(                              'change_location'.tr(),                              style: TextStyle(fontSize: 18),                            ),                          ),                          Expanded(                            child: Container(                              height: 1,                              color: Colors.black,                            ),                          ),                        ],                      ),                      SizedBox(                        height: 10,                      ),                      Text(                        "address_by_location".tr(),                        textAlign: TextAlign.left,                        style: TextStyle(color: Colors.black, fontSize: 18, fontFamily: 'Mulish', fontWeight: FontWeight.w400),                      ),                      SizedBox(                        height: 6,                      ),                      TextFormField(                        textAlignVertical: TextAlignVertical.bottom,                        controller: _addressController,                        decoration: customTextFieldDecoration("enter_map_address".tr()),                        validator: (value) => validateNonEmpty(value ?? "", "enter_map_address".tr()),                      ),                      Container(                          height: 250,                          margin: EdgeInsets.only(top: 10),                          child: YandexMap(                            onMapCreated: (controller) {                              yandexMapController = controller;                              yandexMapController.moveCamera(CameraUpdate.newCameraPosition(                                  CameraPosition(target: Point(latitude: 40.091343636109904, longitude: 67.8383666888557), zoom: 50)));                            },                            onMapTap: (point) {                              latitude = point.latitude;                              longitude = point.longitude;                              _addressController.text = "${point.latitude} ${point.longitude}";                            },                            onMapLongTap: (point) {},                          ))                    ],                  ),                ),              ),            );          })),    );  }  String? validateNonEmpty(String? value, String errorMessage) {    if (value == null || value.isEmpty) {      return errorMessage;    }    return null;  }  InputDecoration customTextFieldDecoration(String label) {    return InputDecoration(      alignLabelWithHint: true,      border: OutlineInputBorder(borderRadius: BorderRadius.all(Radius.circular(5.0))),      labelText: label,      errorBorder: OutlineInputBorder(        borderRadius: BorderRadius.all(Radius.circular(5.0)),        borderSide: BorderSide(color: Colors.red),      ),      focusedErrorBorder: OutlineInputBorder(        borderSide: BorderSide(color: Colors.grey),        borderRadius: BorderRadius.all(Radius.circular(5.0)),      ),      enabledBorder: OutlineInputBorder(        borderSide: BorderSide(color: Colors.grey),        borderRadius: BorderRadius.all(Radius.circular(5.0)),      ),      focusedBorder: OutlineInputBorder(        borderSide: BorderSide(color: Colors.blue), // Change to your desired focused border color        borderRadius: BorderRadius.all(Radius.circular(5.0)),      ),      // hintText: "Login",    );  }}